# 掲示板作成 on Rails/Docker

## Links

* [README Link ](../README.md)
* [tweetApp_Rails_TP/wiki](https://github.com/BoxPistols/tweetApp_Rails_TP/wiki)
* [Bootstrap4.6.1](https://getbootstrap.com/docs/4.6/getting-started/introduction/)
* [Bootstrap5](https://getbootstrap.com/docs/5.1/getting-started/introduction/)

### 前回やった事

* 環境構築
* Docker / Rails
* 掲示板を作成する
  + 必要な作成ファイル
    - コントローラー
    - アクション
    - ルーティング
    - HTML

---

# Bootstrap 4の導入

## Gemfile設定

```rb
#=== Add gem ===
# gem 'bootstrap' 5が入る
gem 'bootstrap', '~> 4.6.1'
gem 'mini_racer'
```

---

### エラーというか5が入ってしまって抜けない?

* いったん5を入れて4を入れ直すとおかしくなった
  + Gemfile.lockの中身を入れ直す、カラにする
  + docker-compose build

---

```
docker-compose build
```

## CSS設定

app/assets/stylesheets/application.css

```css
/* Add */
@import "bootstrap";
```

app/assets/javascripts/application.js

以下for Bootstrapの追加

```js
/* for Bootstrap */
//= require jquery3
//= require popper
//= require bootstrap-sprockets

//= require rails-ujs
//= require activestorage
//= require turbolinks
//= require_tree .
```

---

### 備考: Bootstrapバージョン

* ＊Bootstrap 4はjQueryベースだが、5はjQuery不要
  + [【Rails】Bootstrap5の導入](https://qiita.com/oak1331/items/3b4ebf9b076246c103f4)
  + [rails5にBootstrap5を導入する](https://qiita.com/9ever/items/141d231431e7e2956b74)
  + 一番良さそう[【Rails】bootstrap5の導入方法](https://blog.to-ko-s.com/install-bootstrap5/)

---

[Bootstrap 4実装 Githubコミット](https://github.com/BoxPistols/docker-rails5-2022/pull/4/files)

--

## Base Table UI

[Base Table-Style on index](https://shrtm.nu/FUb9)

---

# Add Model

## 設計: 掲示板で作成するモデル

* タイトル
  + title
    - string
* 作成者
  + name
    - string
* 内容
  + body
    - text（文字数多め）

自動で付与（表記形式は後でカスタムする）
* ID
  + number
* 作成日時
  + timestamp
* 更新日
  + timestamp

### 想定表示

| ID |    タイトル     |  作成者  |   作成日時   |   更新日時    |
|:--:|:-----------:|:-----:|:---------:|:----------:|
| 1  | 雑談掲示板  | 山田太郎 | 2021年1月3日 | 2021年2月12日 |
| 2  | 雑談掲示板2 | 山田花子 | 2021年2月3日 | 2021年3月12日 |
| ...

### モデル作成実行

```bash
docker-compose run web bundle exec rails g model board name:string title:string body:text
```

> ※モデル名は単数表記、テーブルは複数形

* docker-compose run web
  + コンテナーの実行
* bundle exec rails g
  + railsコマンドの実行
* model board
  + モデル作成 モデル名:
* name: string title: string body: text
  + 作成モデル詳細と型

---

### 謎エラー

* 対応

```bash
docker-compose run web bundle exec rails app:update:bin
```

* yes yes ...all

Re: `...rails g model board...`

[参考](https://smot93516.hatenablog.jp/entry/2019/05/22/161921)

---

### 生成ファイル

```bash
invoke  active_record
create    db/migrate/20220102203210_create_boards.rb
create    app/models/board.rb
invoke    test_unit
create      test/models/board_test.rb
create      test/fixtures/boards.yml
```

主なファイル
* app/models/board.rb（モデル名は単数形、カラ）
* db/migrate/20220102203210_create_boards.rb

↓

```rb
class CreateBoards < ActiveRecord::Migration[5.2]
  def change
    create_table :boards do |t|
     # Boardsモデルのオブジェクト、インスタンス変数
      #=== ↓ インスタンス変数　 <=> boardsテーブルの各カラムに対応（命名規則に沿い自動連動） ===
        #===　  = O/Rマッパー dbテーブルのレコードをプログラムのオブジェクトとして扱う機能
      t.string :name
      t.string :title
      t.text :body

      t.timestamps
    end
  end
end
```

`timestamps` = 以下の2つのカラムを作成する
* created_at:レコード(データ)が作成された日時
* updated_at:レコード(データ)が更新された日時

### テーブル作成のマイグレーションを実行

```
docker-compose run web bundle exec rake db:migrate
```

直前実行を取り消す場合

```
docker-compose run web bundle exec rake db:rollback
```
